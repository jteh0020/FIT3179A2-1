{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Domestic Flight Routes Across Major Malaysian Airports (2017–2024)",
  "width": 900,
  "height": 350,
  "projection": {"type": "mercator", "scale": 2400, "center": [110, 4.5]},

  "params": [
    {
      "name": "state_selection",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Johor",
          "Kedah",
          "Kelantan",
          "Melaka",
          "Pahang",
          "Pulau Pinang",
          "Perak",
          "Sabah",
          "Sarawak",
          "Selangor",
          "Terengganu",
          "Federal Territory of Kuala Lumpur",
          "Federal Territory of Labuan"
        ],
        "name": "Select State/Territory: "
      }
    },
    {
      "name": "year_select",
      "value": 2017,
      "bind": {
        "input": "range",
        "min": 2017,
        "max": 2024,
        "step": 1,
        "name": "Select Year: "
      }
    }
  ],

  "layer": [
    {
      "data": {"graticule": {"step": [10, 10]}},
      "mark": {"type": "geoshape", "stroke": "#ccc", "strokeDash": [2, 2], "opacity": 0.8}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/js/malaysia_map.json",
        "format": {"type": "topojson", "feature": "malaysia_map"}
      },
      "mark": {"type": "geoshape", "fill": "#f0f0f0", "stroke": "#333", "strokeWidth": 1}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/malaysia_cities.csv",
        "format": {"type": "csv"}
      },
      "mark": {"type": "circle", "color": "red", "size": 20},
      "encoding": {
        "longitude": {"field": "Longitude", "type": "quantitative"},
        "latitude": {"field": "Latitude", "type": "quantitative"},
        "tooltip": [
          {"field": "City", "type": "nominal", "title": "Airport"},
          {"field": "Longitude", "type": "quantitative"},
          {"field": "Latitude", "type": "quantitative"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/malaysia_cities.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {
          "calculate": "datum.City == 'Kuala Lumpur' ? datum.Longitude + 1 : datum.City == 'Subang' ? datum.Longitude - 0.4 : datum.City == 'Penang' ? datum.Longitude - 0.4 : datum.City == 'Limbang' ? datum.Longitude -0.1  : datum.Longitude",
          "as": "adjusted_lon"
        },
        {
          "calculate": "datum.City == 'Kuala Lumpur' ? datum.Latitude - 0.1 : datum.City == 'Subang' ? datum.Latitude - 0.09 : datum.City == 'Penang' ? datum.Latitude - 0.15 : datum.City == 'Limbang' ? datum.Latitude -0.2 : datum.Latitude",
          "as": "adjusted_lat"
        }
      ],
      "mark": {"type": "text", "fontSize": 10, "color": "darkblue"},
      "encoding": {
        "longitude": {"field": "adjusted_lon"},
        "latitude": {"field": "adjusted_lat"},
        "text": {"field": "City", "type": "nominal"},
        "dy": {"value": -6}
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/dom_sheet2.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "isValid(datum.Year) && datum.Year == year_select"},
        {
          "lookup": "City1",
          "from": {
            "data": {
              "values": [
                {"City": "Alor Setar", "State": "Kedah"},
                {"City": "Bario", "State": "Sarawak"},
                {"City": "Bintulu", "State": "Sarawak"},
                {"City": "Ipoh", "State": "Perak"},
                {"City": "Johor Bahru", "State": "Johor"},
                {"City": "Kota Baharu", "State": "Kelantan"},
                {"City": "Kota Kinabalu", "State": "Sabah"},
                {"City": "Kuala Lumpur", "State": "Federal Territory of Kuala Lumpur"},
                {"City": "Kuantan", "State": "Pahang"},
                {"City": "Kuala Terengganu", "State": "Terengganu"},
                {"City": "Kuching", "State": "Sarawak"},
                {"City": "Labuan", "State": "Federal Territory of Labuan"},
                {"City": "Lahad Datu", "State": "Sabah"},
                {"City": "Langkawi", "State": "Kedah"},
                {"City": "Lawas", "State": "Sarawak"},
                {"City": "Limbang", "State": "Sarawak"},
                {"City": "Long Banga", "State": "Sarawak"},
                {"City": "Malacca", "State": "Melaka"},
                {"City": "Miri", "State": "Sarawak"},
                {"City": "Mukah", "State": "Sarawak"},
                {"City": "Mulu", "State": "Sarawak"},
                {"City": "Penang", "State": "Pulau Pinang"},
                {"City": "Redang", "State": "Terengganu"},
                {"City": "Sandakan", "State": "Sabah"},
                {"City": "Sibu", "State": "Sarawak"},
                {"City": "Subang", "State": "Selangor"},
                {"City": "Tawau", "State": "Sabah"},
                {"City": "Tioman Island", "State": "Pahang"}
              ]
            },
            "key": "City",
            "fields": ["State"]
          }
        },
        {"filter": "state_selection == 'All' || datum.State == state_selection"}
      ],
      "mark": {"type": "rule", "stroke": "#4682b4", "strokeWidth": 1.2, "opacity": 0.6},
      "encoding": {
        "longitude": {"field": "Long1", "type": "quantitative"},
        "latitude": {"field": "Lat1", "type": "quantitative"},
        "longitude2": {"field": "Long2", "type": "quantitative"},
        "latitude2": {"field": "Lat2", "type": "quantitative"},
        "tooltip": [
          {"field": "City1", "type": "nominal", "title": "From"},
          {"field": "City2", "type": "nominal", "title": "To"},
          {"field": "Year", "type": "quantitative", "title": "Year"},
          {"field": "State", "type": "nominal", "title": "Origin State"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {
            "longitude": 110,
            "latitude": -2,
            "text": "Domestic Flight Routes Across Major Malaysian Airports (2017–2024)"
          }
        ]
      },
      "mark": {
        "type": "text",
        "fontSize": 16,
        "fontWeight": "bold",
        "color": "#222",
        "align": "center"
      },
      "encoding": {
        "longitude": {"field": "longitude", "type": "quantitative"},
        "latitude": {"field": "latitude", "type": "quantitative"},
        "text": {"field": "text", "type": "nominal"}
      }
    }
  ]
}
