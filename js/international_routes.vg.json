{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "International Flight Routes Across Major Malaysian Airports (2017–2024)",
    "anchor": "middle",
    "fontSize": 18,
    "fontWeight": "bold",
    "dy": -10
  },
  "width": 1000,
  "height": 450,
  "projection": {"type": "mercator", "scale": 180, "center": [110, 10]},

  "params": [
    {
      "name": "year_select",
      "value": 2017,
      "bind": {
        "input": "range",
        "min": 2017,
        "max": 2024,
        "step": 1,
        "name": "Select Year: "
      }
    },
    {
      "name": "region_select",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All", "Asia", "Europe", "Middle East", "Oceania"],
        "name": "Select Region: "
      }
    }
  ],

  "layer": [
    {
      "data": {"graticule": {"step": [20, 20]}},
      "mark": {"type": "geoshape", "stroke": "#ccc", "strokeDash": [2, 2], "opacity": 0.8}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/js/ne_10m_admin_0_countries.json",
        "format": {"type": "topojson", "feature": "ne_10m_admin_0_countries"}
      },
      "mark": {"type": "geoshape", "fill": "#f0f0f0", "stroke": "#333", "strokeWidth": 0.5}
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/intl_sheet2.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "datum.Year == year_select"},
        {
          "calculate": "datum.Region ? datum.Region : (indexof(['Malaysia','Thailand','Singapore','Vietnam','Indonesia','Philippines','Laos','Cambodia','Myanmar','Brunei Darussalam','China','Japan','South Korea','India','Bangladesh','Nepal','Sri Lanka','Pakistan'], datum.Country) >= 0 ? 'Asia' : indexof(['Australia','New Zealand'], datum.Country) >= 0 ? 'Oceania' : indexof(['United Kingdom','France','Germany','Netherlands'], datum.Country) >= 0 ? 'Europe' : indexof(['United Arab Emirates','Saudi Arabia','Qatar','Oman','Iran','Türkiye','Kuwait'], datum.Country) >= 0 ? 'Middle East' : 'Other')",
          "as": "Region"
        },
        {"filter": "region_select == 'All' || datum.Region == region_select"}
      ],
      "mark": {"type": "rule", "stroke": "steelblue", "strokeWidth": 1.2, "opacity": 0.6},
      "encoding": {
        "longitude": {"field": "Long1", "type": "quantitative"},
        "latitude": {"field": "Lat1", "type": "quantitative"},
        "longitude2": {"field": "Long2", "type": "quantitative"},
        "latitude2": {"field": "Lat2", "type": "quantitative"},
        "tooltip": [
          {"field": "City1", "title": "From"},
          {"field": "City2", "title": "To"},
          {"field": "Country", "title": "Destination Country"},
          {"field": "Region", "title": "Region"},
          {"field": "Year", "title": "Year"}
        ]
      }
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/intl_sheet2.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "datum.Year == year_select"},
        {
          "calculate": "datum.Region ? datum.Region : (indexof(['Malaysia','Thailand','Singapore','Vietnam','Indonesia','Philippines','Laos','Cambodia','Myanmar','Brunei Darussalam','China','Japan','South Korea','India','Bangladesh','Nepal','Sri Lanka','Pakistan'], datum.Country) >= 0 ? 'Asia' : indexof(['Australia','New Zealand'], datum.Country) >= 0 ? 'Oceania' : indexof(['United Kingdom','France','Germany','Netherlands'], datum.Country) >= 0 ? 'Europe' : indexof(['United Arab Emirates','Saudi Arabia','Qatar','Oman','Iran','Türkiye','Kuwait'], datum.Country) >= 0 ? 'Middle East' : 'Other')",
          "as": "Region"
        },
        {"filter": "region_select == 'All' || datum.Region == region_select"}
      ],
      "mark": {"type": "circle", "color": "red", "size": 10, "opacity": 0.9},
      "encoding": {
        "longitude": {"field": "Long1"},
        "latitude": {"field": "Lat1"},
        "tooltip": [{"field": "City1", "title": "Origin Airport"}]
      }
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/jteh0020/FIT3179A2-1/main/data/intl_sheet2.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "datum.Year == year_select"},
        {
          "calculate": "datum.Region ? datum.Region : (indexof(['Malaysia','Thailand','Singapore','Vietnam','Indonesia','Philippines','Laos','Cambodia','Myanmar','Brunei Darussalam','China','Japan','South Korea','India','Bangladesh','Nepal','Sri Lanka','Pakistan'], datum.Country) >= 0 ? 'Asia' : indexof(['Australia','New Zealand'], datum.Country) >= 0 ? 'Oceania' : indexof(['United Kingdom','France','Germany','Netherlands'], datum.Country) >= 0 ? 'Europe' : indexof(['United Arab Emirates','Saudi Arabia','Qatar','Oman','Iran','Türkiye','Kuwait'], datum.Country) >= 0 ? 'Middle East' : 'Other')",
          "as": "Region"
        },
        {"filter": "region_select == 'All' || datum.Region == region_select"}
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 5,
        "dy": 0,
        "fontSize": 5,
        "fontWeight": "bold",
        "color": "black"
      },
      "encoding": {
        "longitude": {"field": "Long1"},
        "latitude": {"field": "Lat1"},
        "text": {"field": "City1"}
      }
    }
  ]
}
